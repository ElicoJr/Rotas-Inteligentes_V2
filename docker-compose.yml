
services:
  openrouteservice:
    image: ghcr.io/giscience/openrouteservice:latest
    container_name: ors-norte-servidor
    ports:
      - "8080:8080" # Mapeia a porta 8080 do contêiner para a 8080 da sua máquina
    
    volumes:
      - ./ors-data:/home/ors/ors-data              # Mapeia seu mapa PBF
      - ./ors-config:/home/ors/ors-config          # Mapeia sua configuração JSON
      - ors-graphs:/home/ors/ors-graphs          # Armazena os grafos processados
      - ors-elevation:/home/ors/ors-elevation-cache # Armazena dados de elevação
      
    environment:
      # --- CONFIGURAÇÃO PRINCIPAL ---
      - ORS_CONFIG_LOCATION=/home/ors/ors-config/ors-config.json
      - ORS_PBF_PATH=/home/ors/ors-data/norte-251029.osm.pbf
      
      # --- ALOCAÇÃO DE MEMÓRIA (MUITO IMPORTANTE) ---
      # Ajuste -Xms (inicial) e -Xmx (máxima) com base na RAM do seu servidor
      # Para a Região Norte, você precisará de pelo menos 8GB-12GB de RAM livres
      - CATALINA_OPTS=-Dcom.sun.management.jmxremote -Djava.rmi.server.hostname=localhost -Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Xms8g -Xmx12g -Djava.awt.headless=true
      
      # --- CONSTRUÇÃO DO GRAFO ---
      # Diz ao ORS para construir os grafos na primeira inicialização
      - ORS_BUILD_GRAPHS=True
      
    restart: unless-stopped

volumes:
  ors-graphs:
  ors-elevation: